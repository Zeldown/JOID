#!/bin/sh

echo ""
echo "ğŸš€ Running pre-push hook"
echo ""
echo ""

echo "ğŸ” Stashing changes"
git stash -q --keep-index

echo ""
echo ""

echo "ğŸ” Checking build status"
./gradlew check
status=$?
if [ $status -ne 0 ]; then
    echo ""
    echo ""
    echo "âŒ Push rejected due to failing gradle check"
    echo ""
    echo ""
    exit $status
fi

echo ""
echo ""

echo "ğŸ‰ Running Gradle tests"
./gradlew test
status=$?
if [ $status -ne 0 ]; then
    echo ""
    echo ""
    echo "âŒ Push rejected due to failing gradle test"
    echo ""
    echo ""
    exit $status
fi

echo ""
echo ""

echo "ğŸ§¹ Popping changes from the stash"
git stash pop -q

echo ""
echo ""
echo "âœ… Done with unit tests"
echo ""
echo ""

# Exit with the captured status
exit $status